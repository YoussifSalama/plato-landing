{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/shared/schema.ts"],"sourcesContent":["import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, date, timestamp, uniqueIndex } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport const demoBookings = pgTable(\"demo_bookings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  bookingDate: date(\"booking_date\").notNull(),\n  bookingTime: text(\"booking_time\").notNull(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n}, (table) => [\n  uniqueIndex(\"unique_date_time\").on(table.bookingDate, table.bookingTime),\n]);\n\nexport const insertDemoBookingSchema = createInsertSchema(demoBookings).pick({\n  bookingDate: true,\n  bookingTime: true,\n  name: true,\n  email: true,\n}).extend({\n  bookingDate: z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/),\n  bookingTime: z.string().regex(/^\\d{1,2}:\\d{2}\\s?(AM|PM)$/i),\n  name: z.string().min(1).max(200),\n  email: z.string().email().max(300),\n});\n\nexport type InsertDemoBooking = z.infer<typeof insertDemoBookingSchema>;\nexport type DemoBooking = typeof demoBookings.$inferSelect;\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;AAEO,MAAM,QAAQ,IAAA,kKAAO,EAAC,SAAS;IACpC,IAAI,IAAA,+KAAO,EAAC,MAAM,UAAU,GAAG,OAAO,CAAC,qJAAG,CAAC,iBAAiB,CAAC;IAC7D,UAAU,IAAA,yKAAI,EAAC,YAAY,OAAO,GAAG,MAAM;IAC3C,UAAU,IAAA,yKAAI,EAAC,YAAY,OAAO;AACpC;AAEO,MAAM,mBAAmB,IAAA,gKAAkB,EAAC,OAAO,IAAI,CAAC;IAC7D,UAAU;IACV,UAAU;AACZ;AAKO,MAAM,eAAe,IAAA,kKAAO,EAAC,iBAAiB;IACnD,IAAI,IAAA,+KAAO,EAAC,MAAM,UAAU,GAAG,OAAO,CAAC,qJAAG,CAAC,iBAAiB,CAAC;IAC7D,aAAa,IAAA,yKAAI,EAAC,gBAAgB,OAAO;IACzC,aAAa,IAAA,yKAAI,EAAC,gBAAgB,OAAO;IACzC,MAAM,IAAA,yKAAI,EAAC,QAAQ,OAAO;IAC1B,OAAO,IAAA,yKAAI,EAAC,SAAS,OAAO;IAC5B,WAAW,IAAA,mLAAS,EAAC,cAAc,UAAU,GAAG,OAAO;AACzD,GAAG,CAAC,QAAU;QACZ,IAAA,wKAAW,EAAC,oBAAoB,EAAE,CAAC,MAAM,WAAW,EAAE,MAAM,WAAW;KACxE;AAEM,MAAM,0BAA0B,IAAA,gKAAkB,EAAC,cAAc,IAAI,CAAC;IAC3E,aAAa;IACb,aAAa;IACb,MAAM;IACN,OAAO;AACT,GAAG,MAAM,CAAC;IACR,aAAa,2IAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IAC9B,aAAa,2IAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IAC9B,MAAM,2IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC;IAC5B,OAAO,2IAAC,CAAC,MAAM,GAAG,KAAK,GAAG,GAAG,CAAC;AAChC"}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/server/db.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\nimport * as schema from \"@shared/schema\";\n\nconst pool = new pg.Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool, { schema });\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,OAAO,IAAI,wJAAE,CAAC,IAAI,CAAC;IACvB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,MAAM,KAAK,IAAA,yKAAO,EAAC,MAAM;IAAE,QAAA;AAAO"}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/server/storage.ts"],"sourcesContent":["import { type User, type InsertUser, type DemoBooking, type InsertDemoBooking, demoBookings } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport { db } from \"./db\";\nimport { eq } from \"drizzle-orm\";\n\nexport interface IStorage {\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  getBookingsByDate(date: string): Promise<DemoBooking[]>;\n  createBooking(booking: InsertDemoBooking): Promise<DemoBooking>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n\n  constructor() {\n    this.users = new Map();\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async getBookingsByDate(date: string): Promise<DemoBooking[]> {\n    return db.select().from(demoBookings).where(eq(demoBookings.bookingDate, date));\n  }\n\n  async createBooking(booking: InsertDemoBooking): Promise<DemoBooking> {\n    const [result] = await db.insert(demoBookings).values(booking).returning();\n    return result;\n  }\n}\n\nexport const storage = new MemStorage();\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAUO,MAAM;IACH,MAAyB;IAEjC,aAAc;QACZ,IAAI,CAAC,KAAK,GAAG,IAAI;IACnB;IAEA,MAAM,QAAQ,EAAU,EAA6B;QACnD,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC;IACxB;IAEA,MAAM,kBAAkB,QAAgB,EAA6B;QACnE,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,IAAI,IAAI,CACzC,CAAC,OAAS,KAAK,QAAQ,KAAK;IAEhC;IAEA,MAAM,WAAW,UAAsB,EAAiB;QACtD,MAAM,KAAK,IAAA,mHAAU;QACrB,MAAM,OAAa;YAAE,GAAG,UAAU;YAAE;QAAG;QACvC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI;QACnB,OAAO;IACT;IAEA,MAAM,kBAAkB,IAAY,EAA0B;QAC5D,OAAO,kIAAE,CAAC,MAAM,GAAG,IAAI,CAAC,kIAAY,EAAE,KAAK,CAAC,IAAA,0KAAE,EAAC,kIAAY,CAAC,WAAW,EAAE;IAC3E;IAEA,MAAM,cAAc,OAA0B,EAAwB;QACpE,MAAM,CAAC,OAAO,GAAG,MAAM,kIAAE,CAAC,MAAM,CAAC,kIAAY,EAAE,MAAM,CAAC,SAAS,SAAS;QACxE,OAAO;IACT;AACF;AAEO,MAAM,UAAU,IAAI"}},
    {"offset": {"line": 263, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/server/email.ts"],"sourcesContent":["// SendGrid integration for sending booking confirmation emails\nimport sgMail from '@sendgrid/mail';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n    ? 'depl ' + process.env.WEB_REPL_RENEWAL\n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X-Replit-Token not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=sendgrid',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X-Replit-Token': xReplitToken,\n      },\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  if (!connectionSettings || (!connectionSettings.settings.api_key || !connectionSettings.settings.from_email)) {\n    throw new Error('SendGrid not connected');\n  }\n  return { apiKey: connectionSettings.settings.api_key, email: connectionSettings.settings.from_email };\n}\n\nasync function getUncachableSendGridClient() {\n  const { apiKey, email } = await getCredentials();\n  sgMail.setApiKey(apiKey);\n  return { client: sgMail, fromEmail: email };\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr + 'T00:00:00');\n  return date.toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n}\n\nfunction getDayName(dateStr: string): string {\n  const date = new Date(dateStr + 'T00:00:00');\n  return date.toLocaleDateString('en-US', { weekday: 'long' });\n}\n\nfunction getFirstName(fullName: string): string {\n  return fullName.trim().split(/\\s+/)[0];\n}\n\nfunction escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;');\n}\n\ninterface BookingEmailData {\n  name: string;\n  email: string;\n  bookingDate: string;\n  bookingTime: string;\n  meetLink?: string;\n  eventLink?: string;\n}\n\nconst HOST_NAME = 'Plato Team';\nconst HOST_TITLE = 'Customer Success';\nconst HOST_EMAIL = 'hello@platohiring.com';\nconst TIMEZONE = 'EET (Egypt Time, UTC+2)';\nconst RESCHEDULE_URL = 'https://platohiring.com/book-demo';\n\nexport async function sendBookingConfirmation(booking: BookingEmailData) {\n  try {\n    const { client, fromEmail } = await getUncachableSendGridClient();\n    const formattedDate = formatDate(booking.bookingDate);\n    const dayName = getDayName(booking.bookingDate);\n    const firstName = getFirstName(booking.name);\n    const time = booking.bookingTime;\n    const meetLink = booking.meetLink || '';\n    const eventLink = booking.eventLink || '';\n\n    const meetLinkRow = meetLink\n      ? `<tr>\n           <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n             <strong>Meeting link:</strong> <a href=\"${meetLink}\" style=\"color:#0966A8;text-decoration:none;word-break:break-all;\">${meetLink}</a>\n           </td>\n         </tr>`\n      : '';\n\n    const joinButtonHtml = meetLink\n      ? `<table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-bottom:16px;\">\n           <tr>\n             <td align=\"center\">\n               <table cellpadding=\"0\" cellspacing=\"0\">\n                 <tr>\n                   <td align=\"center\" style=\"background:#0966A8;border-radius:8px;\">\n                     <a href=\"${meetLink}\" target=\"_blank\" style=\"display:inline-block;padding:14px 36px;color:#ffffff;font-size:15px;font-weight:600;text-decoration:none;\">\n                       Join Google Meet\n                     </a>\n                   </td>\n                 </tr>\n               </table>\n             </td>\n           </tr>\n         </table>`\n      : '';\n\n    const calendarButtonHtml = eventLink\n      ? `<table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-bottom:16px;\">\n           <tr>\n             <td align=\"center\">\n               <table cellpadding=\"0\" cellspacing=\"0\">\n                 <tr>\n                   <td align=\"center\" style=\"background:#ffffff;border:1px solid #d0e3f5;border-radius:8px;\">\n                     <a href=\"${eventLink}\" target=\"_blank\" style=\"display:inline-block;padding:12px 28px;color:#0966A8;font-size:14px;font-weight:600;text-decoration:none;\">\n                       View in Google Calendar\n                     </a>\n                   </td>\n                 </tr>\n               </table>\n             </td>\n           </tr>\n         </table>`\n      : '';\n\n    const msg = {\n      to: booking.email,\n      from: {\n        email: fromEmail,\n        name: 'Plato',\n      },\n      subject: `Your Plato demo is confirmed — ${dayName}, ${formattedDate}`,\n      html: `\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n</head>\n<body style=\"margin:0;padding:0;background-color:#f4f4f5;font-family:Arial,Helvetica,sans-serif;\">\n  <span style=\"display:none;font-size:1px;color:#f4f4f5;line-height:1px;max-height:0;max-width:0;opacity:0;overflow:hidden;\">\n    ${dayName} at ${time} ${TIMEZONE} — 30 min product walkthrough with the Plato team\n  </span>\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f4f4f5;padding:40px 20px;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#ffffff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.06);\">\n\n          <!-- Header -->\n          <tr>\n            <td style=\"background:linear-gradient(135deg,#0966A8,#1EA0E2);padding:28px 40px;text-align:center;\">\n              <h1 style=\"color:#ffffff;margin:0;font-size:22px;font-weight:700;letter-spacing:-0.5px;\">Plato</h1>\n            </td>\n          </tr>\n\n          <!-- Body -->\n          <tr>\n            <td style=\"padding:36px 40px 16px;\">\n              <p style=\"color:#111827;margin:0 0 20px;font-size:16px;line-height:1.6;\">\n                Hi ${escapeHtml(firstName)},\n              </p>\n              <p style=\"color:#111827;margin:0 0 24px;font-size:16px;line-height:1.6;\">\n                Your Plato demo is confirmed.\n              </p>\n\n              <!-- Meeting Details Card -->\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f0f7ff;border-radius:10px;border:1px solid #d0e3f5;margin-bottom:28px;\">\n                <tr>\n                  <td style=\"padding:24px;\">\n                    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                      <tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>When:</strong> ${dayName}, ${formattedDate} &mdash; ${time} ${TIMEZONE}\n                        </td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>Duration:</strong> 30 minutes\n                        </td>\n                      </tr>\n                      ${meetLinkRow}\n                      <tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>Host:</strong> ${HOST_NAME}, ${HOST_TITLE}\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n\n              <!-- Join Meeting CTA -->\n              ${joinButtonHtml}\n\n              <!-- What we'll cover -->\n              <p style=\"color:#111827;margin:0 0 12px;font-size:15px;font-weight:600;\">\n                What we'll cover (30 mins):\n              </p>\n              <table cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom:24px;\">\n                <tr>\n                  <td style=\"padding:4px 0;color:#374151;font-size:14px;line-height:1.7;\">\n                    &#8226;&nbsp; A quick walkthrough of Plato (candidate flow, scoring, shortlisting)\n                  </td>\n                </tr>\n                <tr>\n                  <td style=\"padding:4px 0;color:#374151;font-size:14px;line-height:1.7;\">\n                    &#8226;&nbsp; How companies use it for volume roles, campus hiring, and tech hiring\n                  </td>\n                </tr>\n                <tr>\n                  <td style=\"padding:4px 0;color:#374151;font-size:14px;line-height:1.7;\">\n                    &#8226;&nbsp; Q&amp;A + next steps\n                  </td>\n                </tr>\n              </table>\n\n              <!-- How to prepare -->\n              <p style=\"color:#111827;margin:0 0 12px;font-size:15px;font-weight:600;\">\n                To get the most out of it, feel free to bring:\n              </p>\n              <table cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom:28px;\">\n                <tr>\n                  <td style=\"padding:4px 0;color:#374151;font-size:14px;line-height:1.7;\">\n                    1.&nbsp; A job description you're hiring for (or planning to)\n                  </td>\n                </tr>\n                <tr>\n                  <td style=\"padding:4px 0;color:#374151;font-size:14px;line-height:1.7;\">\n                    2.&nbsp; Your current hiring workflow (even if it's informal)\n                  </td>\n                </tr>\n              </table>\n\n              <!-- View in Calendar -->\n              ${calendarButtonHtml}\n\n              <!-- Reschedule link -->\n              <table cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"margin-bottom:28px;\">\n                <tr>\n                  <td align=\"center\">\n                    <p style=\"color:#6b7280;font-size:13px;margin:0;\">\n                      Need to change the time?\n                      <a href=\"${RESCHEDULE_URL}\" style=\"color:#0966A8;text-decoration:underline;\">Reschedule or cancel</a>\n                    </p>\n                  </td>\n                </tr>\n              </table>\n\n              <!-- Sign-off -->\n              <table cellpadding=\"0\" cellspacing=\"0\" style=\"margin-bottom:8px;border-top:1px solid #e5e7eb;padding-top:24px;\">\n                <tr>\n                  <td style=\"padding-top:24px;\">\n                    <p style=\"color:#374151;font-size:14px;line-height:1.7;margin:0;\">\n                      See you soon,<br>\n                      <strong>${HOST_NAME}</strong><br>\n                      <span style=\"color:#6b7280;\">${HOST_TITLE} | Plato</span><br>\n                      <span style=\"color:#6b7280;\">\n                        <a href=\"mailto:${HOST_EMAIL}\" style=\"color:#0966A8;text-decoration:none;\">${HOST_EMAIL}</a>\n                      </span>\n                    </p>\n                  </td>\n                </tr>\n              </table>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"padding:20px 40px;border-top:1px solid #e5e7eb;text-align:center;\">\n              <p style=\"color:#9ca3af;font-size:11px;margin:0;line-height:1.6;\">\n                &copy; ${new Date().getFullYear()} Plato. All rights reserved. | AI-Powered Hiring Platform\n              </p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>`,\n    };\n\n    await client.send(msg);\n    console.log(`Booking confirmation email sent to ${booking.email}`);\n    return true;\n  } catch (error: any) {\n    console.error('Failed to send booking confirmation email:', error?.response?.body || error.message);\n    return false;\n  }\n}\n\ninterface ContactFormData {\n  name: string;\n  email: string;\n  phone?: string;\n  inquiry?: string;\n  message: string;\n  language?: string;\n}\n\nexport async function sendContactFormEmail(data: ContactFormData) {\n  try {\n    const { client, fromEmail } = await getUncachableSendGridClient();\n\n    const msg = {\n      to: 'info@platohiring.com',\n      from: {\n        email: fromEmail,\n        name: 'Plato Website',\n      },\n      replyTo: {\n        email: data.email,\n        name: data.name,\n      },\n      subject: `New Contact Message — ${escapeHtml(data.name)}${data.inquiry ? ` (${escapeHtml(data.inquiry)})` : ''}`,\n      html: `\n<!DOCTYPE html>\n<html>\n<head><meta charset=\"utf-8\"></head>\n<body style=\"margin:0;padding:0;background-color:#f4f4f5;font-family:Arial,Helvetica,sans-serif;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f4f4f5;padding:40px 20px;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#ffffff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.06);\">\n          <tr>\n            <td style=\"background:linear-gradient(135deg,#0966A8,#1EA0E2);padding:28px 40px;text-align:center;\">\n              <h1 style=\"color:#ffffff;margin:0;font-size:22px;font-weight:700;\">New Contact Form Message</h1>\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding:36px 40px;\">\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#f0f7ff;border-radius:10px;border:1px solid #d0e3f5;margin-bottom:24px;\">\n                <tr>\n                  <td style=\"padding:24px;\">\n                    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                      <tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>Name:</strong> ${escapeHtml(data.name)}\n                        </td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>Email:</strong> <a href=\"mailto:${escapeHtml(data.email)}\" style=\"color:#0966A8;text-decoration:none;\">${escapeHtml(data.email)}</a>\n                        </td>\n                      </tr>\n                      ${data.phone ? `<tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>Phone:</strong> ${escapeHtml(data.phone)}\n                        </td>\n                      </tr>` : ''}\n                      ${data.inquiry ? `<tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>Inquiry Type:</strong> ${escapeHtml(data.inquiry)}\n                        </td>\n                      </tr>` : ''}\n                      ${data.language ? `<tr>\n                        <td style=\"padding:6px 0;color:#374151;font-size:15px;line-height:1.7;\">\n                          <strong>Language:</strong> ${data.language === 'ar' ? 'Arabic' : 'English'}\n                        </td>\n                      </tr>` : ''}\n                    </table>\n                  </td>\n                </tr>\n              </table>\n              <div style=\"margin-bottom:24px;\">\n                <p style=\"color:#111827;font-size:15px;font-weight:600;margin:0 0 8px;\">Message:</p>\n                <p style=\"color:#374151;font-size:14px;line-height:1.7;margin:0;white-space:pre-wrap;\">${escapeHtml(data.message)}</p>\n              </div>\n              <hr style=\"border:none;border-top:1px solid #e5e7eb;margin:24px 0;\">\n              <p style=\"color:#9ca3af;font-size:12px;margin:0;\">\n                You can reply directly to this email to respond to ${escapeHtml(data.name)}.\n              </p>\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding:20px 40px;border-top:1px solid #e5e7eb;text-align:center;\">\n              <p style=\"color:#9ca3af;font-size:11px;margin:0;\">&copy; ${new Date().getFullYear()} Plato. Contact form submission from platohiring.com</p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>`,\n    };\n\n    await client.send(msg);\n    console.log(`Contact form email sent for ${data.name} (${data.email})`);\n    return true;\n  } catch (error: any) {\n    console.error('Failed to send contact form email:', error?.response?.body || error.message);\n    return false;\n  }\n}\n\nexport async function sendBookingNotificationToAdmin(booking: BookingEmailData) {\n  try {\n    const { client, fromEmail } = await getUncachableSendGridClient();\n    const formattedDate = formatDate(booking.bookingDate);\n    const time = booking.bookingTime;\n    const meetLink = booking.meetLink || 'Not generated';\n\n    const msg = {\n      to: 'hello@platohiring.com',\n      from: {\n        email: fromEmail,\n        name: 'Plato Booking System',\n      },\n      subject: `New Demo Booking — ${escapeHtml(booking.name)} on ${formattedDate} at ${time}`,\n      html: `\n<div style=\"font-family:Arial,sans-serif;max-width:500px;padding:20px;\">\n  <h2 style=\"color:#0966A8;margin-bottom:16px;\">New Demo Booking</h2>\n  <p><strong>Name:</strong> ${escapeHtml(booking.name)}</p>\n  <p><strong>Email:</strong> <a href=\"mailto:${escapeHtml(booking.email)}\">${escapeHtml(booking.email)}</a></p>\n  <p><strong>Date:</strong> ${formattedDate}</p>\n  <p><strong>Time:</strong> ${time} ${TIMEZONE}</p>\n  <p><strong>Duration:</strong> 30 minutes</p>\n  <p><strong>Meeting link:</strong> <a href=\"${meetLink}\">${meetLink}</a></p>\n  <hr style=\"border:none;border-top:1px solid #e5e7eb;margin:20px 0;\">\n  <p style=\"color:#6b7280;font-size:13px;\">This is an automated notification from the Plato booking system.</p>\n</div>`,\n    };\n\n    await client.send(msg);\n    console.log(`Admin notification email sent for booking by ${booking.name}`);\n    return true;\n  } catch (error: any) {\n    console.error('Failed to send admin notification email:', error?.response?.body || error.message);\n    return false;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 734, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/lib/server/calendar.ts"],"sourcesContent":["// Google Calendar integration for creating demo booking events with Google Meet links\nimport { google } from 'googleapis';\n\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME;\n  const xReplitToken = process.env.REPL_IDENTITY\n    ? 'repl ' + process.env.REPL_IDENTITY\n    : process.env.WEB_REPL_RENEWAL\n    ? 'depl ' + process.env.WEB_REPL_RENEWAL\n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X-Replit-Token not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=google-calendar',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X-Replit-Token': xReplitToken,\n      },\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('Google Calendar not connected');\n  }\n  return accessToken;\n}\n\nasync function getUncachableGoogleCalendarClient() {\n  const accessToken = await getAccessToken();\n  const oauth2Client = new google.auth.OAuth2();\n  oauth2Client.setCredentials({ access_token: accessToken });\n  return google.calendar({ version: 'v3', auth: oauth2Client });\n}\n\nfunction parseTime(timeStr: string): { hour: number; minute: number } {\n  const match = timeStr.match(/^(\\d{1,2}):(\\d{2})\\s*(AM|PM)$/i);\n  if (!match) throw new Error(`Invalid time format: ${timeStr}`);\n  let hour = parseInt(match[1], 10);\n  const minute = parseInt(match[2], 10);\n  const ampm = match[3].toUpperCase();\n  if (ampm === 'PM' && hour !== 12) hour += 12;\n  if (ampm === 'AM' && hour === 12) hour = 0;\n  return { hour, minute };\n}\n\nexport async function createDemoEvent(booking: {\n  name: string;\n  email: string;\n  bookingDate: string;\n  bookingTime: string;\n}): Promise<{ meetLink: string; eventLink: string }> {\n  const calendar = await getUncachableGoogleCalendarClient();\n  const { hour, minute } = parseTime(booking.bookingTime);\n\n  const startDate = new Date(`${booking.bookingDate}T${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}:00`);\n  const endDate = new Date(startDate.getTime() + 30 * 60 * 1000);\n\n  const formatForCalendar = (d: Date) => {\n    const y = d.getFullYear();\n    const mo = String(d.getMonth() + 1).padStart(2, '0');\n    const da = String(d.getDate()).padStart(2, '0');\n    const h = String(d.getHours()).padStart(2, '0');\n    const mi = String(d.getMinutes()).padStart(2, '0');\n    const s = String(d.getSeconds()).padStart(2, '0');\n    return `${y}-${mo}-${da}T${h}:${mi}:${s}`;\n  };\n\n  const event = {\n    summary: `Plato Demo — ${booking.name}`,\n    description: `30-minute product demo with ${booking.name}.\\n\\nWe'll cover:\\n• Candidate flow, scoring, and shortlisting\\n• Use cases for volume roles, campus hiring, and tech hiring\\n• Q&A and next steps\\n\\nBooker email: ${booking.email}`,\n    start: {\n      dateTime: formatForCalendar(startDate),\n      timeZone: 'Africa/Cairo',\n    },\n    end: {\n      dateTime: formatForCalendar(endDate),\n      timeZone: 'Africa/Cairo',\n    },\n    attendees: [\n      { email: booking.email, displayName: booking.name },\n    ],\n    conferenceData: {\n      createRequest: {\n        requestId: `plato-demo-${booking.bookingDate}-${hour}${minute}-${Date.now()}`,\n        conferenceSolutionKey: { type: 'hangoutsMeet' },\n      },\n    },\n    reminders: {\n      useDefault: false,\n      overrides: [\n        { method: 'email', minutes: 60 },\n        { method: 'popup', minutes: 10 },\n      ],\n    },\n    sendUpdates: 'all',\n  };\n\n  const response = await calendar.events.insert({\n    calendarId: 'primary',\n    requestBody: event,\n    conferenceDataVersion: 1,\n    sendUpdates: 'all',\n  });\n\n  const meetLink = response.data.hangoutLink || response.data.conferenceData?.entryPoints?.[0]?.uri || '';\n  const eventLink = response.data.htmlLink || '';\n\n  console.log(`Google Calendar event created for ${booking.name} — Meet link: ${meetLink}`);\n\n  return { meetLink, eventLink };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 861, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/src/app/api/demo-bookings/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { storage } from \"@/lib/server/storage\";\nimport { insertDemoBookingSchema } from \"@shared/schema\";\nimport { sendBookingConfirmation, sendBookingNotificationToAdmin } from \"@/lib/server/email\";\nimport { createDemoEvent } from \"@/lib/server/calendar\";\n\nexport async function GET(req: NextRequest) {\n  const date = req.nextUrl.searchParams.get(\"date\");\n  if (!date || !/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n    return NextResponse.json({ error: \"Invalid date format. Use YYYY-MM-DD.\" }, { status: 400 });\n  }\n  const bookings = await storage.getBookingsByDate(date);\n  return NextResponse.json(bookings.map((b) => ({ time: b.bookingTime })));\n}\n\nexport async function POST(req: NextRequest) {\n  const body = await req.json();\n  const parsed = insertDemoBookingSchema.safeParse(body);\n  if (!parsed.success) {\n    return NextResponse.json({ error: \"Invalid booking data.\", details: parsed.error.flatten() }, { status: 400 });\n  }\n  const bookingDate = new Date(parsed.data.bookingDate + \"T00:00:00\");\n  const now = new Date();\n  now.setHours(0, 0, 0, 0);\n  if (bookingDate < now) {\n    return NextResponse.json({ error: \"Cannot book a date in the past.\" }, { status: 400 });\n  }\n  const dayOfWeek = bookingDate.getDay();\n  if (dayOfWeek === 5 || dayOfWeek === 6) {\n    return NextResponse.json({ error: \"Cannot book on weekends.\" }, { status: 400 });\n  }\n\n  try {\n    const booking = await storage.createBooking(parsed.data);\n\n    const emailData = {\n      name: parsed.data.name,\n      email: parsed.data.email,\n      bookingDate: parsed.data.bookingDate,\n      bookingTime: parsed.data.bookingTime,\n      meetLink: \"\",\n      eventLink: \"\",\n    };\n\n    try {\n      const calendarResult = await createDemoEvent(parsed.data);\n      emailData.meetLink = calendarResult.meetLink;\n      emailData.eventLink = calendarResult.eventLink;\n    } catch (calErr: any) {\n      console.error(\"Failed to create Google Calendar event:\", calErr.message);\n    }\n\n    sendBookingConfirmation(emailData).catch(() => {});\n    sendBookingNotificationToAdmin(emailData).catch(() => {});\n\n    return NextResponse.json({ id: booking.id, date: booking.bookingDate, time: booking.bookingTime }, { status: 201 });\n  } catch (err: any) {\n    if (err.code === \"23505\") {\n      return NextResponse.json({ error: \"This time slot is already booked.\" }, { status: 409 });\n    }\n    throw err;\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;;;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,OAAO,IAAI,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC;IAC1C,IAAI,CAAC,QAAQ,CAAC,sBAAsB,IAAI,CAAC,OAAO;QAC9C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuC,GAAG;YAAE,QAAQ;QAAI;IAC5F;IACA,MAAM,WAAW,MAAM,4IAAO,CAAC,iBAAiB,CAAC;IACjD,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,IAAM,CAAC;YAAE,MAAM,EAAE,WAAW;QAAC,CAAC;AACvE;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,SAAS,6IAAuB,CAAC,SAAS,CAAC;IACjD,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAyB,SAAS,OAAO,KAAK,CAAC,OAAO;QAAG,GAAG;YAAE,QAAQ;QAAI;IAC9G;IACA,MAAM,cAAc,IAAI,KAAK,OAAO,IAAI,CAAC,WAAW,GAAG;IACvD,MAAM,MAAM,IAAI;IAChB,IAAI,QAAQ,CAAC,GAAG,GAAG,GAAG;IACtB,IAAI,cAAc,KAAK;QACrB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkC,GAAG;YAAE,QAAQ;QAAI;IACvF;IACA,MAAM,YAAY,YAAY,MAAM;IACpC,IAAI,cAAc,KAAK,cAAc,GAAG;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;IAEA,IAAI;QACF,MAAM,UAAU,MAAM,4IAAO,CAAC,aAAa,CAAC,OAAO,IAAI;QAEvD,MAAM,YAAY;YAChB,MAAM,OAAO,IAAI,CAAC,IAAI;YACtB,OAAO,OAAO,IAAI,CAAC,KAAK;YACxB,aAAa,OAAO,IAAI,CAAC,WAAW;YACpC,aAAa,OAAO,IAAI,CAAC,WAAW;YACpC,UAAU;YACV,WAAW;QACb;QAEA,IAAI;YACF,MAAM,iBAAiB,MAAM,IAAA,qJAAe,EAAC,OAAO,IAAI;YACxD,UAAU,QAAQ,GAAG,eAAe,QAAQ;YAC5C,UAAU,SAAS,GAAG,eAAe,SAAS;QAChD,EAAE,OAAO,QAAa;YACpB,QAAQ,KAAK,CAAC,2CAA2C,OAAO,OAAO;QACzE;QAEA,IAAA,0JAAuB,EAAC,WAAW,KAAK,CAAC,KAAO;QAChD,IAAA,iKAA8B,EAAC,WAAW,KAAK,CAAC,KAAO;QAEvD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,IAAI,QAAQ,EAAE;YAAE,MAAM,QAAQ,WAAW;YAAE,MAAM,QAAQ,WAAW;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnH,EAAE,OAAO,KAAU;QACjB,IAAI,IAAI,IAAI,KAAK,SAAS;YACxB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoC,GAAG;gBAAE,QAAQ;YAAI;QACzF;QACA,MAAM;IACR;AACF"}}]
}